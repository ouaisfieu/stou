
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards ‚Äî Apprentissage Ludique</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-hover: #252540;
            --border: #2a2a4a;
            --text: #e8e8f0;
            --text-muted: #8888aa;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        html, body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        
        /* === HEADER === */
        .header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.8rem;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-title { font-size: 1.3rem; font-weight: 700; }
        .header-sub { font-size: 0.75rem; color: var(--text-muted); }
        
        .header-stats {
            display: flex;
            gap: 1.5rem;
            margin-left: auto;
        }
        
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: var(--accent); }
        .stat-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; }
        
        .header-actions { display: flex; gap: 0.5rem; margin-left: 1rem; }
        
        .btn {
            padding: 0.6rem 1rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        
        .btn:hover { background: var(--border); transform: translateY(-1px); }
        .btn.primary { background: var(--accent); border-color: var(--accent); }
        .btn.primary:hover { background: #5558e8; }
        .btn.success { background: var(--success); border-color: var(--success); }
        .btn.danger { background: transparent; color: var(--danger); border-color: var(--danger); }
        
        /* === NAVIGATION TABS === */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }
        
        .nav-tab {
            padding: 0.7rem 1.2rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        
        .nav-tab:hover { background: var(--bg-hover); color: var(--text); }
        .nav-tab.active { background: var(--accent); color: white; }
        
        .nav-tab .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        /* === MAIN CONTENT === */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .view { display: none; }
        .view.active { display: block; }
        
        /* === DECKS VIEW === */
        .decks-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .decks-header h2 { font-size: 1.3rem; }
        
        .decks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .deck-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .deck-card:hover { border-color: var(--accent); transform: translateY(-2px); }
        
        .deck-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--deck-color, var(--accent));
        }
        
        .deck-icon { font-size: 2rem; margin-bottom: 0.75rem; }
        .deck-name { font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem; }
        .deck-count { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.75rem; }
        
        .deck-progress {
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .deck-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #4ade80);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        .deck-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .deck-stat { display: flex; align-items: center; gap: 0.3rem; }
        .deck-stat.mastered { color: var(--success); }
        .deck-stat.learning { color: var(--warning); }
        .deck-stat.new { color: var(--text-muted); }
        
        .deck-actions {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .deck-card:hover .deck-actions { opacity: 1; }
        
        .deck-action-btn {
            width: 28px;
            height: 28px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .deck-action-btn:hover { background: var(--bg-hover); color: var(--text); }
        
        /* Add deck card */
        .deck-card.add-new {
            border-style: dashed;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 180px;
            color: var(--text-muted);
        }
        
        .deck-card.add-new:hover { color: var(--accent); border-color: var(--accent); }
        .deck-card.add-new .add-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        
        /* === STUDY VIEW === */
        .study-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .study-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .study-back {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .study-back:hover { color: var(--text); }
        
        .study-title { font-size: 1.2rem; font-weight: 600; flex: 1; }
        
        .study-progress-bar {
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .study-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #a855f7);
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .study-counter {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }
        
        /* Flashcard */
        .flashcard-container {
            perspective: 1000px;
            margin-bottom: 2rem;
        }
        
        .flashcard {
            width: 100%;
            min-height: 300px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .flashcard-face {
            position: absolute;
            inset: 0;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
            text-align: center;
        }
        
        .flashcard-back { transform: rotateY(180deg); }
        
        .flashcard-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }
        
        .flashcard-front .flashcard-label { color: var(--accent); }
        .flashcard-back .flashcard-label { color: var(--success); }
        
        .flashcard-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .flashcard-hint {
            position: absolute;
            bottom: 1rem;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Study actions */
        .study-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .study-btn {
            flex: 1;
            max-width: 200px;
            padding: 1rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }
        
        .study-btn:hover { transform: translateY(-2px); }
        
        .study-btn.again { border-color: var(--danger); }
        .study-btn.again:hover { background: rgba(239, 68, 68, 0.1); }
        
        .study-btn.good { border-color: var(--warning); }
        .study-btn.good:hover { background: rgba(245, 158, 11, 0.1); }
        
        .study-btn.easy { border-color: var(--success); }
        .study-btn.easy:hover { background: rgba(34, 197, 94, 0.1); }
        
        .study-btn-icon { font-size: 1.5rem; }
        .study-btn-label { font-size: 0.7rem; color: var(--text-muted); }
        
        /* === QUIZ VIEW === */
        .quiz-container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .quiz-question {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .quiz-question-text {
            font-size: 1.15rem;
            line-height: 1.6;
        }
        
        .quiz-input-container {
            margin-bottom: 1.5rem;
        }
        
        .quiz-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            text-align: center;
            transition: border-color 0.2s;
        }
        
        .quiz-input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .quiz-input.correct { border-color: var(--success); background: rgba(34, 197, 94, 0.1); }
        .quiz-input.incorrect { border-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        
        .quiz-answer-reveal {
            background: var(--bg-card);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .quiz-answer-label {
            font-size: 0.7rem;
            color: var(--success);
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }
        
        .quiz-score {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .quiz-score-item {
            text-align: center;
        }
        
        .quiz-score-value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .quiz-score-value.correct { color: var(--success); }
        .quiz-score-value.incorrect { color: var(--danger); }
        
        /* === CHALLENGE VIEW === */
        .challenge-timer {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .challenge-time {
            font-size: 4rem;
            font-weight: 700;
            color: var(--accent);
            font-variant-numeric: tabular-nums;
        }
        
        .challenge-time.warning { color: var(--warning); }
        .challenge-time.danger { color: var(--danger); animation: pulse 0.5s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .challenge-streak {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .streak-label { font-size: 0.8rem; color: var(--text-muted); }
        .streak-value { font-size: 2rem; font-weight: 700; color: var(--success); }
        
        /* === RESULTS VIEW === */
        .results-container {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }
        
        .results-icon { font-size: 4rem; margin-bottom: 1rem; }
        .results-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .results-subtitle { color: var(--text-muted); margin-bottom: 2rem; }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .results-stat {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1rem;
        }
        
        .results-stat-value { font-size: 1.5rem; font-weight: 700; }
        .results-stat-label { font-size: 0.7rem; color: var(--text-muted); }
        
        /* === IMPORT MODAL === */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-overlay.open { display: flex; }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
        }
        
        .modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title { font-size: 1.1rem; font-weight: 600; }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-body { padding: 1.25rem; }
        
        .modal-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        .field-group { margin-bottom: 1rem; }
        .field-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.3rem; display: block; }
        
        .field-input, .field-select {
            width: 100%;
            padding: 0.6rem;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
        }
        
        /* Drop zone */
        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            border-color: var(--accent);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .drop-zone-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .drop-zone-text { color: var(--text-muted); font-size: 0.85rem; }
        .drop-zone-hint { color: var(--text-muted); font-size: 0.7rem; margin-top: 0.5rem; }
        
        /* Color picker */
        .color-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: white; box-shadow: 0 0 0 2px var(--accent); }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 2000;
            animation: slideIn 0.3s;
        }
        
        .toast.show { display: flex; }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-icon { font-size: 1.3rem; }
        .toast-message { font-size: 0.85rem; }
        
        input[type="file"] { display: none; }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }
        
        .empty-icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }
        .empty-title { font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--text); }
        .empty-text { font-size: 0.85rem; margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo">üß†</div>
        <div>
            <div class="header-title">Flashcards</div>
            <div class="header-sub">Apprentissage ludique</div>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalDecks">0</div>
                <div class="stat-label">Decks</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalCards">0</div>
                <div class="stat-label">Cartes</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalMastered">0</div>
                <div class="stat-label">Ma√Ætris√©es</div>
            </div>
        </div>
        
        <div class="header-actions">
            <button class="btn" onclick="exportAllData()">üì§ Export</button>
            <button class="btn primary" onclick="openImportModal()">üì• Importer un deck</button>
        </div>
    </header>
    
    <!-- NAV TABS -->
    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="showView('decks')">
            üìö Mes Decks
        </button>
        <button class="nav-tab" onclick="showView('study')" id="navStudy" style="display:none;">
            üìñ √âtude
        </button>
        <button class="nav-tab" onclick="showView('quiz')" id="navQuiz" style="display:none;">
            üéØ Quiz
        </button>
        <button class="nav-tab" onclick="showView('challenge')" id="navChallenge" style="display:none;">
            ‚ö° D√©fi
        </button>
    </nav>
    
    <!-- MAIN -->
    <main class="main">
        <!-- DECKS VIEW -->
        <div class="view active" id="viewDecks">
            <div class="decks-header">
                <h2>üìö Mes Decks</h2>
            </div>
            <div class="decks-grid" id="decksGrid"></div>
        </div>
        
        <!-- STUDY VIEW -->
        <div class="view" id="viewStudy">
            <div class="study-container">
                <div class="study-header">
                    <button class="study-back" onclick="exitStudy()">‚Üê</button>
                    <div class="study-title" id="studyTitle">Deck</div>
                    <button class="btn" onclick="shuffleStudyCards()">üîÄ M√©langer</button>
                </div>
                
                <div class="study-progress-bar">
                    <div class="study-progress-fill" id="studyProgressFill" style="width: 0%"></div>
                </div>
                
                <div class="study-counter" id="studyCounter">Carte 1 / 10</div>
                
                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="flashcard-face flashcard-front">
                            <div class="flashcard-label">Question</div>
                            <div class="flashcard-content" id="cardQuestion">...</div>
                            <div class="flashcard-hint">Cliquez pour retourner</div>
                        </div>
                        <div class="flashcard-face flashcard-back">
                            <div class="flashcard-label">R√©ponse</div>
                            <div class="flashcard-content" id="cardAnswer">...</div>
                        </div>
                    </div>
                </div>
                
                <div class="study-actions" id="studyActions">
                    <button class="study-btn again" onclick="rateCard(0)">
                        <span class="study-btn-icon">üîÑ</span>
                        <span>√Ä revoir</span>
                        <span class="study-btn-label">Je ne savais pas</span>
                    </button>
                    <button class="study-btn good" onclick="rateCard(1)">
                        <span class="study-btn-icon">üëç</span>
                        <span>Correct</span>
                        <span class="study-btn-label">Avec effort</span>
                    </button>
                    <button class="study-btn easy" onclick="rateCard(2)">
                        <span class="study-btn-icon">‚≠ê</span>
                        <span>Facile</span>
                        <span class="study-btn-label">Je ma√Ætrise</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- QUIZ VIEW -->
        <div class="view" id="viewQuiz">
            <div class="quiz-container">
                <div class="study-header">
                    <button class="study-back" onclick="exitStudy()">‚Üê</button>
                    <div class="study-title" id="quizTitle">Quiz</div>
                </div>
                
                <div class="quiz-score">
                    <div class="quiz-score-item">
                        <div class="quiz-score-value correct" id="quizCorrect">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="quiz-score-item">
                        <div class="quiz-score-value incorrect" id="quizIncorrect">0</div>
                        <div class="stat-label">Incorrect</div>
                    </div>
                </div>
                
                <div class="study-counter" id="quizCounter">Question 1 / 10</div>
                
                <div class="quiz-question">
                    <div class="quiz-question-text" id="quizQuestion">...</div>
                </div>
                
                <div class="quiz-input-container">
                    <input type="text" class="quiz-input" id="quizInput" placeholder="Tapez votre r√©ponse..." onkeypress="if(event.key==='Enter')checkQuizAnswer()">
                </div>
                
                <div class="quiz-answer-reveal" id="quizReveal" style="display:none;">
                    <div class="quiz-answer-label">R√©ponse correcte</div>
                    <div id="quizCorrectAnswer"></div>
                </div>
                
                <div style="text-align:center;">
                    <button class="btn primary" id="quizSubmitBtn" onclick="checkQuizAnswer()">V√©rifier</button>
                    <button class="btn primary" id="quizNextBtn" onclick="nextQuizQuestion()" style="display:none;">Suivant ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- CHALLENGE VIEW -->
        <div class="view" id="viewChallenge">
            <div class="quiz-container">
                <div class="study-header">
                    <button class="study-back" onclick="exitStudy()">‚Üê</button>
                    <div class="study-title" id="challengeTitle">D√©fi Chrono</div>
                </div>
                
                <div class="challenge-timer">
                    <div class="challenge-time" id="challengeTime">2:00</div>
                </div>
                
                <div class="challenge-streak">
                    <div class="streak-label">Score</div>
                    <div class="streak-value" id="challengeScore">0</div>
                </div>
                
                <div class="quiz-question">
                    <div class="quiz-question-text" id="challengeQuestion">...</div>
                </div>
                
                <div class="quiz-input-container">
                    <input type="text" class="quiz-input" id="challengeInput" placeholder="R√©ponse rapide..." onkeypress="if(event.key==='Enter')checkChallengeAnswer()">
                </div>
                
                <div style="text-align:center;">
                    <button class="btn success" onclick="checkChallengeAnswer()">‚úì Valider</button>
                    <button class="btn" onclick="skipChallengeQuestion()">Passer ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- RESULTS VIEW -->
        <div class="view" id="viewResults">
            <div class="results-container">
                <div class="results-icon" id="resultsIcon">üéâ</div>
                <div class="results-title" id="resultsTitle">Session termin√©e !</div>
                <div class="results-subtitle" id="resultsSubtitle">Beau travail !</div>
                
                <div class="results-stats">
                    <div class="results-stat">
                        <div class="results-stat-value" id="resultsTotal">0</div>
                        <div class="results-stat-label">Cartes vues</div>
                    </div>
                    <div class="results-stat">
                        <div class="results-stat-value" style="color:var(--success);" id="resultsCorrect">0</div>
                        <div class="results-stat-label">Correctes</div>
                    </div>
                    <div class="results-stat">
                        <div class="results-stat-value" style="color:var(--warning);" id="resultsToReview">0</div>
                        <div class="results-stat-label">√Ä revoir</div>
                    </div>
                </div>
                
                <div style="display:flex;gap:1rem;justify-content:center;">
                    <button class="btn" onclick="showView('decks')">‚Üê Retour aux decks</button>
                    <button class="btn primary" onclick="restartSession()">üîÑ Recommencer</button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- IMPORT MODAL -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üì• Importer un deck</div>
                <button class="modal-close" onclick="closeImportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="field-group">
                    <label class="field-label">Nom du deck</label>
                    <input type="text" class="field-input" id="importDeckName" placeholder="Ex: Strat√©gie Colruyt">
                </div>
                
                <div class="field-group">
                    <label class="field-label">Cat√©gorie</label>
                    <input type="text" class="field-input" id="importDeckCategory" placeholder="Ex: Prospection, Citoyennet√©...">
                </div>
                
                <div class="field-group">
                    <label class="field-label">Couleur</label>
                    <div class="color-options" id="colorOptions">
                        <div class="color-option selected" style="background:#6366f1;" data-color="#6366f1"></div>
                        <div class="color-option" style="background:#a855f7;" data-color="#a855f7"></div>
                        <div class="color-option" style="background:#ec4899;" data-color="#ec4899"></div>
                        <div class="color-option" style="background:#ef4444;" data-color="#ef4444"></div>
                        <div class="color-option" style="background:#f59e0b;" data-color="#f59e0b"></div>
                        <div class="color-option" style="background:#22c55e;" data-color="#22c55e"></div>
                        <div class="color-option" style="background:#14b8a6;" data-color="#14b8a6"></div>
                        <div class="color-option" style="background:#3b82f6;" data-color="#3b82f6"></div>
                    </div>
                </div>
                
                <div class="field-group">
                    <label class="field-label">Fichier CSV</label>
                    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                        <div class="drop-zone-icon">üìÑ</div>
                        <div class="drop-zone-text">Glissez un fichier CSV ou cliquez</div>
                        <div class="drop-zone-hint">Format: "Question","R√©ponse" (une par ligne)</div>
                    </div>
                    <div id="fileInfo" style="margin-top:0.5rem;font-size:0.8rem;color:var(--success);display:none;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeImportModal()">Annuler</button>
                <button class="btn primary" onclick="importDeck()">Importer</button>
            </div>
        </div>
    </div>
    
    <!-- DECK OPTIONS MODAL -->
    <div class="modal-overlay" id="deckModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="deckModalTitle">üìö Deck</div>
                <button class="modal-close" onclick="closeDeckModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:1.5rem;" id="deckModalInfo"></p>
                
                <div style="display:flex;flex-direction:column;gap:0.75rem;">
                    <button class="btn" onclick="startStudy()" style="justify-content:flex-start;padding:1rem;">
                        <span style="font-size:1.3rem;">üìñ</span>
                        <span>
                            <strong>Mode √âtude</strong><br>
                            <small style="color:var(--text-muted);">Flashcards √† retourner, marquez votre niveau</small>
                        </span>
                    </button>
                    <button class="btn" onclick="startQuiz()" style="justify-content:flex-start;padding:1rem;">
                        <span style="font-size:1.3rem;">üéØ</span>
                        <span>
                            <strong>Mode Quiz</strong><br>
                            <small style="color:var(--text-muted);">Tapez la r√©ponse, testez vos connaissances</small>
                        </span>
                    </button>
                    <button class="btn" onclick="startChallenge()" style="justify-content:flex-start;padding:1rem;">
                        <span style="font-size:1.3rem;">‚ö°</span>
                        <span>
                            <strong>Mode D√©fi</strong><br>
                            <small style="color:var(--text-muted);">2 minutes chrono, combien de bonnes r√©ponses ?</small>
                        </span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn danger" onclick="deleteDeck()">üóëÔ∏è Supprimer</button>
                <button class="btn" onclick="closeDeckModal()">Fermer</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast">
        <span class="toast-icon">‚úì</span>
        <span class="toast-message">Message</span>
    </div>
    
    <input type="file" id="fileInput" accept=".csv,.json" onchange="handleFileSelect(event)">

<script>
// ============ STATE ============
const STORAGE_KEY = 'flashcards_app_v1';

let data = {
    decks: []
};

let currentDeckId = null;
let studyCards = [];
let studyIndex = 0;
let studyResults = { correct: 0, incorrect: 0, toReview: 0 };
let quizAnswered = false;
let challengeTimer = null;
let challengeTimeLeft = 120;
let pendingFileData = null;
let selectedColor = '#6366f1';

// ============ INIT ============
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    renderDecks();
    updateGlobalStats();
    setupDropZone();
    setupColorPicker();
});

function loadData() {
    try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) data = JSON.parse(saved);
        if (!data.decks) data.decks = [];
    } catch(e) { console.error(e); }
}

function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

// ============ GLOBAL STATS ============
function updateGlobalStats() {
    let totalCards = 0;
    let totalMastered = 0;
    
    data.decks.forEach(deck => {
        totalCards += deck.cards.length;
        deck.cards.forEach(card => {
            if (card.level >= 2) totalMastered++;
        });
    });
    
    document.getElementById('totalDecks').textContent = data.decks.length;
    document.getElementById('totalCards').textContent = totalCards;
    document.getElementById('totalMastered').textContent = totalMastered;
}

// ============ VIEWS ============
function showView(viewId) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('view' + viewId.charAt(0).toUpperCase() + viewId.slice(1)).classList.add('active');
    
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    event?.target?.classList?.add('active');
}

// ============ DECKS ============
function renderDecks() {
    const grid = document.getElementById('decksGrid');
    
    if (data.decks.length === 0) {
        grid.innerHTML = `
            <div class="deck-card add-new" onclick="openImportModal()">
                <div class="add-icon">+</div>
                <div>Importer un deck</div>
            </div>
        `;
        return;
    }
    
    let html = data.decks.map(deck => {
        const total = deck.cards.length;
        const mastered = deck.cards.filter(c => c.level >= 2).length;
        const learning = deck.cards.filter(c => c.level === 1).length;
        const newCards = deck.cards.filter(c => c.level === 0).length;
        const progress = total > 0 ? (mastered / total) * 100 : 0;
        
        return `
            <div class="deck-card" style="--deck-color:${deck.color || '#6366f1'};" onclick="openDeckModal('${deck.id}')">
                <div class="deck-actions">
                    <button class="deck-action-btn" onclick="event.stopPropagation();editDeck('${deck.id}')">‚úèÔ∏è</button>
                </div>
                <div class="deck-icon">${deck.icon || 'üìö'}</div>
                <div class="deck-name">${deck.name}</div>
                <div class="deck-count">${total} cartes${deck.category ? ' ‚Ä¢ ' + deck.category : ''}</div>
                <div class="deck-progress">
                    <div class="deck-progress-bar" style="width:${progress}%"></div>
                </div>
                <div class="deck-stats">
                    <span class="deck-stat mastered">‚úì ${mastered}</span>
                    <span class="deck-stat learning">‚óê ${learning}</span>
                    <span class="deck-stat new">‚óã ${newCards}</span>
                </div>
            </div>
        `;
    }).join('');
    
    html += `
        <div class="deck-card add-new" onclick="openImportModal()">
            <div class="add-icon">+</div>
            <div>Ajouter un deck</div>
        </div>
    `;
    
    grid.innerHTML = html;
}

function openDeckModal(deckId) {
    currentDeckId = deckId;
    const deck = data.decks.find(d => d.id === deckId);
    if (!deck) return;
    
    document.getElementById('deckModalTitle').textContent = deck.icon + ' ' + deck.name;
    document.getElementById('deckModalInfo').textContent = `${deck.cards.length} cartes${deck.category ? ' ‚Ä¢ Cat√©gorie: ' + deck.category : ''}`;
    
    document.getElementById('deckModal').classList.add('open');
}

function closeDeckModal() {
    document.getElementById('deckModal').classList.remove('open');
}

function deleteDeck() {
    if (!currentDeckId) return;
    if (!confirm('Supprimer ce deck et toutes ses cartes ?')) return;
    
    data.decks = data.decks.filter(d => d.id !== currentDeckId);
    saveData();
    closeDeckModal();
    renderDecks();
    updateGlobalStats();
    showToast('Deck supprim√©');
}

// ============ IMPORT ============
function openImportModal() {
    document.getElementById('importDeckName').value = '';
    document.getElementById('importDeckCategory').value = '';
    document.getElementById('fileInfo').style.display = 'none';
    pendingFileData = null;
    document.getElementById('importModal').classList.add('open');
}

function closeImportModal() {
    document.getElementById('importModal').classList.remove('open');
}

function setupDropZone() {
    const dropZone = document.getElementById('dropZone');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
        dropZone.addEventListener(evt, e => {
            e.preventDefault();
            e.stopPropagation();
        });
    });
    
    ['dragenter', 'dragover'].forEach(evt => {
        dropZone.addEventListener(evt, () => dropZone.classList.add('dragover'));
    });
    
    ['dragleave', 'drop'].forEach(evt => {
        dropZone.addEventListener(evt, () => dropZone.classList.remove('dragover'));
    });
    
    dropZone.addEventListener('drop', e => {
        const file = e.dataTransfer.files[0];
        if (file) processFile(file);
    });
}

function setupColorPicker() {
    document.querySelectorAll('.color-option').forEach(opt => {
        opt.addEventListener('click', () => {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            selectedColor = opt.dataset.color;
        });
    });
}

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) processFile(file);
    event.target.value = '';
}

function processFile(file) {
    const reader = new FileReader();
    
    reader.onload = (e) => {
        try {
            let cards = [];
            const content = e.target.result;
            
            if (file.name.endsWith('.json')) {
                const json = JSON.parse(content);
                if (Array.isArray(json)) {
                    cards = json.map(item => ({
                        q: item.question || item.q || item.front,
                        a: item.answer || item.a || item.back
                    }));
                }
            } else {
                // CSV parsing
                const lines = content.replace(/\r\n/g, '\n').split('\n').filter(l => l.trim());
                
                lines.forEach(line => {
                    // Handle quoted CSV
                    const match = line.match(/^"(.+?)","(.+?)"$/);
                    if (match) {
                        cards.push({ q: match[1], a: match[2] });
                    } else {
                        // Try comma or semicolon
                        const sep = line.includes('","') ? '","' : (line.includes(';') ? ';' : ',');
                        const parts = line.split(sep).map(p => p.replace(/^"|"$/g, '').trim());
                        if (parts.length >= 2 && parts[0] && parts[1]) {
                            cards.push({ q: parts[0], a: parts[1] });
                        }
                    }
                });
            }
            
            if (cards.length === 0) {
                showToast('Aucune carte trouv√©e', 'error');
                return;
            }
            
            pendingFileData = cards;
            document.getElementById('fileInfo').textContent = `‚úì ${cards.length} cartes d√©tect√©es`;
            document.getElementById('fileInfo').style.display = 'block';
            
            // Auto-fill name from filename
            if (!document.getElementById('importDeckName').value) {
                const name = file.name.replace(/\.[^/.]+$/, '').replace(/_/g, ' ').replace(/flashcards?/gi, '').trim();
                document.getElementById('importDeckName').value = name || 'Nouveau deck';
            }
            
        } catch (err) {
            console.error(err);
            showToast('Erreur de lecture: ' + err.message, 'error');
        }
    };
    
    reader.readAsText(file);
}

function importDeck() {
    if (!pendingFileData || pendingFileData.length === 0) {
        showToast('Importez d\'abord un fichier', 'error');
        return;
    }
    
    const name = document.getElementById('importDeckName').value.trim() || 'Nouveau deck';
    const category = document.getElementById('importDeckCategory').value.trim() || null;
    
    const deck = {
        id: 'd' + Date.now(),
        name,
        category,
        color: selectedColor,
        icon: 'üìö',
        createdAt: new Date().toISOString(),
        cards: pendingFileData.map((card, i) => ({
            id: 'c' + Date.now() + i,
            question: card.q,
            answer: card.a,
            level: 0, // 0=new, 1=learning, 2=mastered
            lastReview: null,
            reviews: 0
        }))
    };
    
    data.decks.push(deck);
    saveData();
    
    closeImportModal();
    renderDecks();
    updateGlobalStats();
    showToast(`${deck.cards.length} cartes import√©es !`);
}

// ============ STUDY MODE ============
function startStudy() {
    closeDeckModal();
    const deck = data.decks.find(d => d.id === currentDeckId);
    if (!deck) return;
    
    studyCards = shuffleArray([...deck.cards]);
    studyIndex = 0;
    studyResults = { correct: 0, incorrect: 0, toReview: 0 };
    
    document.getElementById('studyTitle').textContent = deck.name;
    document.getElementById('navStudy').style.display = 'flex';
    
    showView('study');
    showStudyCard();
}

function showStudyCard() {
    if (studyIndex >= studyCards.length) {
        showResults('study');
        return;
    }
    
    const card = studyCards[studyIndex];
    document.getElementById('cardQuestion').textContent = card.question;
    document.getElementById('cardAnswer').textContent = card.answer;
    document.getElementById('flashcard').classList.remove('flipped');
    
    document.getElementById('studyCounter').textContent = `Carte ${studyIndex + 1} / ${studyCards.length}`;
    document.getElementById('studyProgressFill').style.width = ((studyIndex / studyCards.length) * 100) + '%';
}

function flipCard() {
    document.getElementById('flashcard').classList.toggle('flipped');
}

function rateCard(rating) {
    const card = studyCards[studyIndex];
    const deckIndex = data.decks.findIndex(d => d.id === currentDeckId);
    const cardIndex = data.decks[deckIndex].cards.findIndex(c => c.id === card.id);
    
    // Update card level
    if (rating === 0) {
        data.decks[deckIndex].cards[cardIndex].level = 0;
        studyResults.toReview++;
    } else if (rating === 1) {
        data.decks[deckIndex].cards[cardIndex].level = 1;
        studyResults.correct++;
    } else {
        data.decks[deckIndex].cards[cardIndex].level = 2;
        studyResults.correct++;
    }
    
    data.decks[deckIndex].cards[cardIndex].lastReview = new Date().toISOString();
    data.decks[deckIndex].cards[cardIndex].reviews++;
    
    saveData();
    studyIndex++;
    showStudyCard();
}

function shuffleStudyCards() {
    studyCards = shuffleArray(studyCards);
    studyIndex = 0;
    showStudyCard();
    showToast('Cartes m√©lang√©es');
}

// ============ QUIZ MODE ============
function startQuiz() {
    closeDeckModal();
    const deck = data.decks.find(d => d.id === currentDeckId);
    if (!deck) return;
    
    studyCards = shuffleArray([...deck.cards]);
    studyIndex = 0;
    studyResults = { correct: 0, incorrect: 0, toReview: 0 };
    
    document.getElementById('quizTitle').textContent = deck.name;
    document.getElementById('navQuiz').style.display = 'flex';
    document.getElementById('quizCorrect').textContent = '0';
    document.getElementById('quizIncorrect').textContent = '0';
    
    showView('quiz');
    showQuizQuestion();
}

function showQuizQuestion() {
    if (studyIndex >= studyCards.length) {
        showResults('quiz');
        return;
    }
    
    quizAnswered = false;
    const card = studyCards[studyIndex];
    document.getElementById('quizQuestion').textContent = card.question;
    document.getElementById('quizInput').value = '';
    document.getElementById('quizInput').className = 'quiz-input';
    document.getElementById('quizInput').disabled = false;
    document.getElementById('quizInput').focus();
    document.getElementById('quizReveal').style.display = 'none';
    document.getElementById('quizSubmitBtn').style.display = 'inline-flex';
    document.getElementById('quizNextBtn').style.display = 'none';
    
    document.getElementById('quizCounter').textContent = `Question ${studyIndex + 1} / ${studyCards.length}`;
}

function checkQuizAnswer() {
    if (quizAnswered) return;
    quizAnswered = true;
    
    const card = studyCards[studyIndex];
    const userAnswer = document.getElementById('quizInput').value.trim().toLowerCase();
    const correctAnswer = card.answer.toLowerCase();
    
    // Simple matching (contains key words)
    const isCorrect = userAnswer.length > 3 && (
        correctAnswer.includes(userAnswer) || 
        userAnswer.includes(correctAnswer.substring(0, 20)) ||
        similarity(userAnswer, correctAnswer) > 0.5
    );
    
    const inputEl = document.getElementById('quizInput');
    inputEl.disabled = true;
    
    if (isCorrect) {
        inputEl.classList.add('correct');
        studyResults.correct++;
        document.getElementById('quizCorrect').textContent = studyResults.correct;
    } else {
        inputEl.classList.add('incorrect');
        studyResults.incorrect++;
        document.getElementById('quizIncorrect').textContent = studyResults.incorrect;
    }
    
    document.getElementById('quizCorrectAnswer').textContent = card.answer;
    document.getElementById('quizReveal').style.display = 'block';
    document.getElementById('quizSubmitBtn').style.display = 'none';
    document.getElementById('quizNextBtn').style.display = 'inline-flex';
}

function nextQuizQuestion() {
    studyIndex++;
    showQuizQuestion();
}

// Simple similarity function
function similarity(s1, s2) {
    const longer = s1.length > s2.length ? s1 : s2;
    const shorter = s1.length > s2.length ? s2 : s1;
    if (longer.length === 0) return 1.0;
    const costs = [];
    for (let i = 0; i <= s1.length; i++) {
        let lastValue = i;
        for (let j = 0; j <= s2.length; j++) {
            if (i === 0) costs[j] = j;
            else if (j > 0) {
                let newValue = costs[j - 1];
                if (s1[i - 1] !== s2[j - 1]) newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                costs[j - 1] = lastValue;
                lastValue = newValue;
            }
        }
        if (i > 0) costs[s2.length] = lastValue;
    }
    return (longer.length - costs[s2.length]) / longer.length;
}

// ============ CHALLENGE MODE ============
function startChallenge() {
    closeDeckModal();
    const deck = data.decks.find(d => d.id === currentDeckId);
    if (!deck) return;
    
    studyCards = shuffleArray([...deck.cards]);
    studyIndex = 0;
    studyResults = { correct: 0, incorrect: 0, toReview: 0 };
    challengeTimeLeft = 120;
    
    document.getElementById('challengeTitle').textContent = '‚ö° ' + deck.name;
    document.getElementById('navChallenge').style.display = 'flex';
    document.getElementById('challengeScore').textContent = '0';
    
    showView('challenge');
    showChallengeQuestion();
    startChallengeTimer();
}

function startChallengeTimer() {
    updateChallengeTime();
    challengeTimer = setInterval(() => {
        challengeTimeLeft--;
        updateChallengeTime();
        
        if (challengeTimeLeft <= 0) {
            clearInterval(challengeTimer);
            showResults('challenge');
        }
    }, 1000);
}

function updateChallengeTime() {
    const mins = Math.floor(challengeTimeLeft / 60);
    const secs = challengeTimeLeft % 60;
    const timeEl = document.getElementById('challengeTime');
    timeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    
    timeEl.className = 'challenge-time';
    if (challengeTimeLeft <= 30) timeEl.classList.add('danger');
    else if (challengeTimeLeft <= 60) timeEl.classList.add('warning');
}

function showChallengeQuestion() {
    if (studyIndex >= studyCards.length) {
        studyCards = shuffleArray(studyCards);
        studyIndex = 0;
    }
    
    const card = studyCards[studyIndex];
    document.getElementById('challengeQuestion').textContent = card.question;
    document.getElementById('challengeInput').value = '';
    document.getElementById('challengeInput').focus();
}

function checkChallengeAnswer() {
    const card = studyCards[studyIndex];
    const userAnswer = document.getElementById('challengeInput').value.trim().toLowerCase();
    const correctAnswer = card.answer.toLowerCase();
    
    const isCorrect = userAnswer.length > 2 && (
        correctAnswer.includes(userAnswer) || 
        similarity(userAnswer, correctAnswer) > 0.4
    );
    
    if (isCorrect) {
        studyResults.correct++;
        document.getElementById('challengeScore').textContent = studyResults.correct;
    }
    
    studyIndex++;
    showChallengeQuestion();
}

function skipChallengeQuestion() {
    studyIndex++;
    showChallengeQuestion();
}

// ============ RESULTS ============
function showResults(mode) {
    if (challengeTimer) {
        clearInterval(challengeTimer);
        challengeTimer = null;
    }
    
    const total = studyResults.correct + studyResults.incorrect + studyResults.toReview;
    const percentage = total > 0 ? Math.round((studyResults.correct / total) * 100) : 0;
    
    let icon = 'üéâ';
    let title = 'Session termin√©e !';
    let subtitle = 'Beau travail !';
    
    if (mode === 'challenge') {
        icon = '‚ö°';
        title = `${studyResults.correct} bonnes r√©ponses !`;
        subtitle = 'D√©fi chrono termin√©';
    } else if (percentage >= 80) {
        icon = 'üèÜ';
        title = 'Excellent !';
        subtitle = `${percentage}% de r√©ussite`;
    } else if (percentage >= 50) {
        icon = 'üëç';
        title = 'Bien jou√© !';
        subtitle = `${percentage}% de r√©ussite`;
    } else {
        icon = 'üí™';
        title = 'Continue !';
        subtitle = 'La r√©p√©tition est la cl√©';
    }
    
    document.getElementById('resultsIcon').textContent = icon;
    document.getElementById('resultsTitle').textContent = title;
    document.getElementById('resultsSubtitle').textContent = subtitle;
    document.getElementById('resultsTotal').textContent = total;
    document.getElementById('resultsCorrect').textContent = studyResults.correct;
    document.getElementById('resultsToReview').textContent = studyResults.toReview + studyResults.incorrect;
    
    showView('results');
    updateGlobalStats();
    renderDecks();
}

function restartSession() {
    const deck = data.decks.find(d => d.id === currentDeckId);
    if (deck) openDeckModal(currentDeckId);
    else showView('decks');
}

function exitStudy() {
    if (challengeTimer) {
        clearInterval(challengeTimer);
        challengeTimer = null;
    }
    
    document.getElementById('navStudy').style.display = 'none';
    document.getElementById('navQuiz').style.display = 'none';
    document.getElementById('navChallenge').style.display = 'none';
    
    showView('decks');
    renderDecks();
    updateGlobalStats();
}

// ============ EXPORT ============
function exportAllData() {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'flashcards-backup.json';
    a.click();
    showToast('Export t√©l√©charg√©');
}

// ============ UTILS ============
function shuffleArray(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.querySelector('.toast-icon').textContent = type === 'error' ? '‚úï' : '‚úì';
    toast.querySelector('.toast-message').textContent = message;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

// Close modals
document.querySelectorAll('.modal-overlay').forEach(m => {
    m.addEventListener('click', e => {
        if (e.target === m) m.classList.remove('open');
    });
});
</script>
</body>
</html>
