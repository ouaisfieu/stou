<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANOPTICON v2 ‚Äî Graphe de Pouvoir</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }
        
        .app {
            display: grid;
            grid-template-columns: 260px 1fr 300px;
            height: 100vh;
        }
        
        /* Sidebar gauche */
        .sidebar {
            background: #0f0f18;
            border-right: 1px solid #2a2a3a;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid #2a2a3a;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .title { font-weight: 600; }
        .badge { font-size: 0.6rem; background: #4ade80; color: black; padding: 2px 6px; border-radius: 3px; }
        
        .entity-list {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .entity-item {
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 4px;
        }
        
        .entity-item:hover { background: #1a1a28; }
        .entity-item.active { background: #6366f1; }
        
        .entity-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .entity-icon.person { background: rgba(99, 102, 241, 0.3); }
        .entity-icon.organization { background: rgba(34, 211, 238, 0.3); }
        .entity-icon.company { background: rgba(74, 222, 128, 0.3); }
        
        .entity-name { font-size: 0.85rem; font-weight: 500; }
        .entity-role { font-size: 0.7rem; color: #888; }
        
        /* Zone graphe */
        .graph-area {
            background: #14141f;
            position: relative;
        }
        
        #graphSvg {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .node circle {
            stroke: #0a0a0f;
            stroke-width: 2px;
            cursor: pointer;
        }
        
        .node circle:hover {
            stroke: #22d3ee;
            stroke-width: 3px;
        }
        
        .node text {
            font-size: 11px;
            fill: #e0e0e0;
            pointer-events: none;
        }
        
        .link {
            stroke: #888;
            stroke-opacity: 0.6;
        }
        
        .link.hierarchy { stroke: #a78bfa; }
        .link.collaboration { stroke: #22d3ee; }
        .link.conflict { stroke: #f87171; stroke-dasharray: 5,3; }
        
        .link-label {
            font-size: 9px;
            fill: #888;
        }
        
        /* Toolbar */
        .toolbar {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        
        .toolbar button {
            padding: 0.5rem 0.75rem;
            background: #1a1a28;
            border: 1px solid #2a2a3a;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .toolbar button:hover { background: #2a2a3a; }
        .toolbar button.active { background: #6366f1; border-color: #6366f1; }
        
        /* Stats */
        .stats {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 1rem;
            z-index: 10;
        }
        
        .stat {
            text-align: center;
            padding: 0.5rem 1rem;
            background: #1a1a28;
            border-radius: 6px;
        }
        
        .stat-value { font-size: 1.2rem; font-weight: 600; color: #6366f1; }
        .stat-label { font-size: 0.65rem; color: #888; }
        
        /* Panel droit */
        .detail-panel {
            background: #0f0f18;
            border-left: 1px solid #2a2a3a;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #2a2a3a;
            margin-bottom: 1rem;
        }
        
        .detail-avatar {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .detail-name { font-size: 1.1rem; font-weight: 600; }
        .detail-role { font-size: 0.8rem; color: #888; }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section-title {
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
        }
        
        .detail-field {
            margin-bottom: 0.75rem;
        }
        
        .detail-field label {
            display: block;
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.25rem;
        }
        
        .detail-field input,
        .detail-field textarea {
            width: 100%;
            padding: 0.5rem;
            background: #14141f;
            border: 1px solid #2a2a3a;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.85rem;
        }
        
        .relation-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #14141f;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #888;
            text-align: center;
        }
        
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">üîç</div>
                <span class="title">PANOPTICON</span>
                <span class="badge">v2</span>
            </div>
            <div class="entity-list" id="entityList"></div>
        </aside>
        
        <!-- Graph -->
        <main class="graph-area">
            <div class="toolbar">
                <button onclick="zoomIn()">üîç+</button>
                <button onclick="zoomOut()">üîç‚àí</button>
                <button onclick="resetZoom()">‚Ü∫</button>
                <button id="btnLabels" class="active" onclick="toggleLabels()">Labels</button>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="statEntities">0</div>
                    <div class="stat-label">ENTIT√âS</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="statRelations">0</div>
                    <div class="stat-label">RELATIONS</div>
                </div>
            </div>
            
            <svg id="graphSvg"></svg>
        </main>
        
        <!-- Detail Panel -->
        <aside class="detail-panel">
            <div id="detailEmpty" class="empty-state">
                <div class="empty-icon">üëÜ</div>
                <div>S√©lectionnez une entit√©</div>
            </div>
            <div id="detailContent" style="display: none;">
                <div class="detail-header">
                    <div class="detail-avatar" id="detailAvatar">üë§</div>
                    <div>
                        <div class="detail-name" id="detailName">-</div>
                        <div class="detail-role" id="detailRole">-</div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-section-title">Description</div>
                    <p id="detailDesc" style="font-size: 0.85rem; line-height: 1.5;">-</p>
                </div>
                
                <div class="detail-section">
                    <div class="detail-section-title">Relations</div>
                    <div id="detailRelations"></div>
                </div>
            </div>
        </aside>
    </div>

<script>
// ============ DATA ============
const entities = [
    { id: 'bouchez', name: 'Georges-Louis Bouchez', type: 'person', role: 'Pr√©sident MR', desc: 'Pr√©sident du Mouvement R√©formateur depuis 2019, r√©√©lu en 2024.' },
    { id: 'magnette', name: 'Paul Magnette', type: 'person', role: 'Pr√©sident PS', desc: 'Pr√©sident du Parti Socialiste, bourgmestre de Charleroi.' },
    { id: 'dewever', name: 'Bart De Wever', type: 'person', role: 'Premier Ministre', desc: 'Premier Ministre depuis f√©vrier 2025. Ex-pr√©sident N-VA.' },
    { id: 'vanpeel', name: 'Valerie Van Peel', type: 'person', role: 'Pr√©sidente N-VA', desc: 'Pr√©sidente N-VA depuis avril 2025, succ√®de √† De Wever.' },
    { id: 'engelaar', name: 'Bert Engelaar', type: 'person', role: 'Pr√©sident FGTB', desc: 'Pr√©sident FGTB depuis d√©cembre 2025.' },
    { id: 'bodson', name: 'Thierry Bodson', type: 'person', role: 'Co-pr√©sident Solidaris', desc: 'Ex-pr√©sident FGTB, co-pr√©sident Solidaris/UNMS.' },
    { id: 'labille', name: 'Jean-Pascal Labille', type: 'person', role: 'SG Solidaris', desc: 'Secr√©taire g√©n√©ral UNMS/Solidaris.' },
    { id: 'mr', name: 'MR', type: 'organization', role: 'Parti lib√©ral', desc: 'Mouvement R√©formateur - Premier parti francophone.' },
    { id: 'ps', name: 'PS', type: 'organization', role: 'Parti socialiste', desc: 'Parti Socialiste belge francophone.' },
    { id: 'nva', name: 'N-VA', type: 'organization', role: 'Parti nationaliste', desc: 'Nieuw-Vlaamse Alliantie - Premier parti flamand.' },
    { id: 'fgtb', name: 'FGTB', type: 'organization', role: 'Syndicat', desc: 'F√©d√©ration G√©n√©rale du Travail de Belgique.' },
    { id: 'solidaris', name: 'Solidaris', type: 'organization', role: 'Mutualit√©', desc: 'Mutualit√© socialiste (ex-UNMS).' },
    { id: 'arizona', name: 'Gouvernement Arizona', type: 'organization', role: 'Gouvernement f√©d√©ral', desc: 'Coalition N-VA/MR/CD&V/Vooruit/Engag√©s.' }
];

const relations = [
    { source: 'bouchez', target: 'mr', type: 'hierarchy', label: 'pr√©side' },
    { source: 'magnette', target: 'ps', type: 'hierarchy', label: 'pr√©side' },
    { source: 'vanpeel', target: 'nva', type: 'hierarchy', label: 'pr√©side' },
    { source: 'engelaar', target: 'fgtb', type: 'hierarchy', label: 'pr√©side' },
    { source: 'bodson', target: 'solidaris', type: 'hierarchy', label: 'co-pr√©side' },
    { source: 'labille', target: 'solidaris', type: 'hierarchy', label: 'secr√©taire g√©n√©ral' },
    { source: 'dewever', target: 'arizona', type: 'hierarchy', label: 'dirige' },
    { source: 'dewever', target: 'nva', type: 'collaboration', label: 'membre' },
    { source: 'mr', target: 'arizona', type: 'collaboration', label: 'coalition' },
    { source: 'nva', target: 'arizona', type: 'collaboration', label: 'coalition' },
    { source: 'ps', target: 'fgtb', type: 'collaboration', label: 'Action Commune' },
    { source: 'ps', target: 'solidaris', type: 'collaboration', label: 'pilier' },
    { source: 'fgtb', target: 'solidaris', type: 'collaboration', label: 'pilier' },
    { source: 'bouchez', target: 'magnette', type: 'conflict', label: 'opposition' },
    { source: 'mr', target: 'ps', type: 'conflict', label: 'opposition' }
];

const COLORS = {
    person: '#6366f1',
    organization: '#22d3ee',
    company: '#4ade80'
};

const ICONS = {
    person: 'üë§',
    organization: 'üèõÔ∏è',
    company: 'üè¢'
};

// ============ STATE ============
let showLabels = true;
let selectedId = null;
let simulation, svg, g, zoom;

// ============ INIT ============
document.addEventListener('DOMContentLoaded', () => {
    renderEntityList();
    updateStats();
    initGraph();
});

// ============ ENTITY LIST ============
function renderEntityList() {
    const container = document.getElementById('entityList');
    container.innerHTML = entities.map(e => `
        <div class="entity-item ${e.id === selectedId ? 'active' : ''}" 
             onclick="selectEntity('${e.id}')">
            <div class="entity-icon ${e.type}">${ICONS[e.type] || '‚ùì'}</div>
            <div>
                <div class="entity-name">${e.name}</div>
                <div class="entity-role">${e.role}</div>
            </div>
        </div>
    `).join('');
}

function updateStats() {
    document.getElementById('statEntities').textContent = entities.length;
    document.getElementById('statRelations').textContent = relations.length;
}

// ============ GRAPH ============
function initGraph() {
    const container = document.querySelector('.graph-area');
    const width = container.clientWidth;
    const height = container.clientHeight;
    
    svg = d3.select('#graphSvg')
        .attr('width', width)
        .attr('height', height);
    
    // Zoom
    zoom = d3.zoom()
        .scaleExtent([0.2, 4])
        .on('zoom', (event) => {
            g.attr('transform', event.transform);
        });
    
    svg.call(zoom);
    
    // Main group
    g = svg.append('g');
    
    // Prepare data
    const nodes = entities.map(e => ({ ...e }));
    const links = relations.map(r => ({ 
        source: r.source, 
        target: r.target, 
        type: r.type,
        label: r.label
    }));
    
    // Simulation
    simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(120))
        .force('charge', d3.forceManyBody().strength(-400))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(50));
    
    // Draw links
    const link = g.append('g')
        .selectAll('line')
        .data(links)
        .join('line')
        .attr('class', d => `link ${d.type}`);
    
    // Draw link labels
    const linkLabel = g.append('g')
        .selectAll('text')
        .data(links)
        .join('text')
        .attr('class', 'link-label')
        .text(d => d.label);
    
    // Draw nodes
    const node = g.append('g')
        .selectAll('g')
        .data(nodes)
        .join('g')
        .attr('class', 'node')
        .call(d3.drag()
            .on('start', dragStarted)
            .on('drag', dragged)
            .on('end', dragEnded))
        .on('click', (event, d) => {
            event.stopPropagation();
            selectEntity(d.id);
        });
    
    node.append('circle')
        .attr('r', d => d.type === 'person' ? 20 : 25)
        .attr('fill', d => COLORS[d.type] || '#888');
    
    node.append('text')
        .attr('dy', d => d.type === 'person' ? 35 : 40)
        .attr('text-anchor', 'middle')
        .text(d => d.name.length > 20 ? d.name.substring(0, 18) + '...' : d.name);
    
    // Tick
    simulation.on('tick', () => {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);
        
        linkLabel
            .attr('x', d => (d.source.x + d.target.x) / 2)
            .attr('y', d => (d.source.y + d.target.y) / 2);
        
        node.attr('transform', d => `translate(${d.x},${d.y})`);
    });
    
    // Click on background to deselect
    svg.on('click', () => {
        selectedId = null;
        renderEntityList();
        document.getElementById('detailEmpty').style.display = 'flex';
        document.getElementById('detailContent').style.display = 'none';
        d3.selectAll('.node circle').attr('stroke-width', 2).attr('stroke', '#0a0a0f');
    });
    
    function dragStarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    
    function dragEnded(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
}

// ============ SELECTION ============
function selectEntity(id) {
    selectedId = id;
    const entity = entities.find(e => e.id === id);
    if (!entity) return;
    
    // Update list
    renderEntityList();
    
    // Update detail panel
    document.getElementById('detailEmpty').style.display = 'none';
    document.getElementById('detailContent').style.display = 'block';
    document.getElementById('detailAvatar').textContent = ICONS[entity.type] || '‚ùì';
    document.getElementById('detailAvatar').className = `detail-avatar ${entity.type}`;
    document.getElementById('detailAvatar').style.background = `${COLORS[entity.type]}33`;
    document.getElementById('detailName').textContent = entity.name;
    document.getElementById('detailRole').textContent = entity.role;
    document.getElementById('detailDesc').textContent = entity.desc;
    
    // Relations
    const rels = relations.filter(r => r.source === id || r.target === id);
    const relContainer = document.getElementById('detailRelations');
    relContainer.innerHTML = rels.map(r => {
        const otherId = r.source === id ? r.target : r.source;
        const other = entities.find(e => e.id === otherId);
        const arrow = r.source === id ? '‚Üí' : '‚Üê';
        return `<div class="relation-item">${arrow} ${r.label} <strong>${other?.name || otherId}</strong></div>`;
    }).join('') || '<div style="color:#888;">Aucune relation</div>';
    
    // Highlight in graph
    d3.selectAll('.node circle')
        .attr('stroke-width', d => d.id === id ? 4 : 2)
        .attr('stroke', d => d.id === id ? '#fbbf24' : '#0a0a0f');
}

// ============ CONTROLS ============
function zoomIn() {
    svg.transition().call(zoom.scaleBy, 1.5);
}

function zoomOut() {
    svg.transition().call(zoom.scaleBy, 0.67);
}

function resetZoom() {
    const container = document.querySelector('.graph-area');
    svg.transition().call(zoom.transform, d3.zoomIdentity
        .translate(container.clientWidth / 2, container.clientHeight / 2)
        .scale(1)
        .translate(-container.clientWidth / 2, -container.clientHeight / 2));
}

function toggleLabels() {
    showLabels = !showLabels;
    document.getElementById('btnLabels').classList.toggle('active', showLabels);
    d3.selectAll('.node text').style('display', showLabels ? 'block' : 'none');
    d3.selectAll('.link-label').style('display', showLabels ? 'block' : 'none');
}

// Resize
window.addEventListener('resize', () => {
    const container = document.querySelector('.graph-area');
    svg.attr('width', container.clientWidth).attr('height', container.clientHeight);
    simulation.force('center', d3.forceCenter(container.clientWidth / 2, container.clientHeight / 2));
    simulation.alpha(0.3).restart();
});
</script>
</body>
</html>
